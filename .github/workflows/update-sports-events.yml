name: Update sports events

on:
  # Run automatically every day at 09:00 UTC
  schedule:
    - cron: "0 9 * * *"

  # Allow manual trigger from GitHub Actions UI
  workflow_dispatch:

permissions:
  # Needed so the workflow can commit updated JSON files
  contents: write

jobs:
  update-sports-events:
    runs-on: ubuntu-latest

    steps:
      # ---------------------------------------------------------
      # 1. Checkout repository
      # ---------------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # ---------------------------------------------------------
      # 2. Install Node.js (required to run the script)
      # ---------------------------------------------------------
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # ---------------------------------------------------------
      # 3. Install npm dependencies if package.json exists
      #    - Uses npm ci if lockfile exists
      #    - Falls back to npm install
      #    - Skips installation if no package.json
      # ---------------------------------------------------------
      - name: Install dependencies (if any)
        run: |
          if [ -f package-lock.json ]; then
            npm ci
          elif [ -f package.json ]; then
            npm install
          else
            echo "No package.json found, skip npm install"
          fi

      # ---------------------------------------------------------
      # 4. Generate the latest sports events JSON
      #    The script writes output directly to:
      #    docs/data/sports_events.json
      # ---------------------------------------------------------
      - name: Generate sports events JSON
        run: node scripts/generate_sports_events.js

      # ---------------------------------------------------------
      # 5. Commit changes only if the JSON file was updated
      #    - This ensures no empty commits
      #    - Only the sports events file is monitored
      # ---------------------------------------------------------
      - name: Commit & push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: update sports events (data changed)"
          file_pattern: "docs/data/sports_events.json"
